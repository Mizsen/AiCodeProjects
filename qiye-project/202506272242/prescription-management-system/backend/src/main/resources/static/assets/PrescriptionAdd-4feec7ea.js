import{I as U}from"./ImageUploaderMobile-150bdec4.js";import{I as x}from"./ImageViewer-63d13274.js";import{_ as N,r as m,a as w,o as D,e as d,f as _,g as V,h as o,w as r,p as k,q as M,E as f,l as q,s as C,F,j as h,i as A,k as B}from"./index-adc39c24.js";/* empty css                                                                    */const E={components:{ImageUploaderMobile:U,ImageViewer:x},setup(){const u=m({prescriptionName:"",indications:"",usage:"",treatmentCycle:""}),e=m([]),c=m([]),t=m([]),g=w(),b=async()=>{const l=await k.listDrugs({page:1,size:1e3});t.value=l.data.list},p=async()=>{try{const l=new FormData;l.append("prescription",JSON.stringify(u.value)),l.append("drugIds",JSON.stringify(e.value.map(n=>n.id?n.id:n))),c.value.forEach(n=>{l.append("images",n)});const i=await M.addPrescription(l);if(i.data&&i.data.success){f.success(i.data.msg||"新增药方成功");const n=i.data.prescriptionId||i.data.id;n&&g.push({name:"PrescriptionDetail",params:{id:n}})}else f.error(i.data.msg||"新增药方失败")}catch{f.error("新增药方失败")}},s=l=>{c.value=l};return D(()=>{b()}),{prescription:u,selectedDrugs:e,prescriptionImages:c,drugs:t,submitForm:p,handleImageUpload:s}}},P={class:"prescription-add"};function S(u,e,c,t,g,b){const p=d("el-input"),s=d("el-form-item"),l=d("el-option"),i=d("el-select"),n=d("ImageUploaderMobile"),y=d("el-button"),v=d("el-form"),I=d("el-card");return _(),V("div",P,[o(I,{class:"form-card"},{default:r(()=>[e[6]||(e[6]=q("h2",{style:{"margin-bottom":"24px"}},"新增药方",-1)),o(v,{onSubmit:C(t.submitForm,["prevent"]),"label-width":"100px",model:t.prescription},{default:r(()=>[o(s,{label:"药方名称",required:""},{default:r(()=>[o(p,{modelValue:t.prescription.prescriptionName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.prescription.prescriptionName=a),placeholder:"请输入药方名称"},null,8,["modelValue"])]),_:1}),o(s,{label:"适应症",required:""},{default:r(()=>[o(p,{type:"textarea",modelValue:t.prescription.indications,"onUpdate:modelValue":e[1]||(e[1]=a=>t.prescription.indications=a),placeholder:"请输入适应症"},null,8,["modelValue"])]),_:1}),o(s,{label:"用法用量",required:""},{default:r(()=>[o(p,{type:"textarea",modelValue:t.prescription.usage,"onUpdate:modelValue":e[2]||(e[2]=a=>t.prescription.usage=a),placeholder:"请输入用法用量"},null,8,["modelValue"])]),_:1}),o(s,{label:"治疗周期",required:""},{default:r(()=>[o(p,{modelValue:t.prescription.treatmentCycle,"onUpdate:modelValue":e[3]||(e[3]=a=>t.prescription.treatmentCycle=a),placeholder:"如 5 天 / 疗程"},null,8,["modelValue"])]),_:1}),o(s,{label:"关联药品"},{default:r(()=>[o(i,{modelValue:t.selectedDrugs,"onUpdate:modelValue":e[4]||(e[4]=a=>t.selectedDrugs=a),multiple:"",filterable:"",placeholder:"请选择关联药品","value-key":"id"},{default:r(()=>[(_(!0),V(F,null,h(t.drugs,a=>(_(),A(l,{key:a.id,label:a.drugName,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(s,{label:"药方图片"},{default:r(()=>[o(n,{onUpload:t.handleImageUpload},null,8,["onUpload"])]),_:1}),o(s,null,{default:r(()=>[o(y,{type:"danger","native-type":"submit"},{default:r(()=>e[5]||(e[5]=[B("新增药方")])),_:1,__:[5]})]),_:1})]),_:1},8,["onSubmit","model"])]),_:1,__:[6]})])}const L=N(E,[["render",S],["__scopeId","data-v-297856a9"]]);export{L as default};
