import{I as E}from"./ImageUploader-c4064d67.js";import{I as q}from"./ImageViewer-63d13274.js";import{_ as B,b as F,a as S,r as p,o as M,e as s,f,g as N,l as z,h as a,w as o,s as A,q as I,p as R,E as C,F as U,j as k,i as x,k as w}from"./index-adc39c24.js";/* empty css                                                                    */const j={components:{ImageUploader:E,ImageViewer:q},setup(){const c=F(),t=S(),d=p({prescriptionName:"",indications:"",usage:"",treatmentCycle:""}),e=p([]),D=p([]),b=p([]),i=p([]),r=p([]),m=p([]),g=async()=>{const n=c.params.id;if(!n)return;const u=(await I.getPrescription(n)).data;d.value={prescriptionName:u.prescription.prescriptionName,indications:u.prescription.indications,usage:u.prescription.usage,treatmentCycle:u.prescription.treatmentCycle},r.value=u.drugs||[],i.value=u.images||[]},_=async()=>{const n=await R.listDrugs({page:1,size:1e3});m.value=n.data.list},v=async()=>{const n=c.params.id;try{await I.updatePrescription(n,{prescriptionName:d.value.prescriptionName,indications:d.value.indications,usage:d.value.usage,treatmentCycle:d.value.treatmentCycle,drug_ids:e.value,images:i.value}),C.success("更新成功"),t.push({name:"PrescriptionDetail",params:{id:n}})}catch{C.error("更新失败，请重试")}},y=async()=>{c.params.id,e.value.length&&g()},V=n=>{b.value=n},l=()=>{const n=c.params.id;t.push({name:"PrescriptionDetail",params:{id:n}})};return M(()=>{_(),g()}),{prescription:d,selectedDrugs:e,prescriptionImages:i,drugs:r,drugsNew:m,selectedDrugsNew:D,prescriptionImagesNew:b,submitForm:v,handleImageUpload:V,deleteSelectedDrugs:y,cancel:l}}},L={class:"prescription-edit"};function T(c,t,d,e,D,b){const i=s("el-input"),r=s("el-form-item"),m=s("el-option"),g=s("el-select"),_=s("el-button"),v=s("ImageViewer"),y=s("ImageUploader"),V=s("el-form");return f(),N("div",L,[t[9]||(t[9]=z("h2",null,"Edit Prescription",-1)),a(V,{onSubmit:A(e.submitForm,["prevent"]),"label-width":"120px",model:e.prescription},{default:o(()=>[a(r,{label:"药方名称"},{default:o(()=>[a(i,{modelValue:e.prescription.prescriptionName,"onUpdate:modelValue":t[0]||(t[0]=l=>e.prescription.prescriptionName=l),required:""},null,8,["modelValue"])]),_:1}),a(r,{label:"适应症"},{default:o(()=>[a(i,{type:"textarea",modelValue:e.prescription.indications,"onUpdate:modelValue":t[1]||(t[1]=l=>e.prescription.indications=l),required:""},null,8,["modelValue"])]),_:1}),a(r,{label:"用法"},{default:o(()=>[a(i,{type:"textarea",modelValue:e.prescription.usage,"onUpdate:modelValue":t[2]||(t[2]=l=>e.prescription.usage=l),required:""},null,8,["modelValue"])]),_:1}),a(r,{label:"疗程"},{default:o(()=>[a(i,{modelValue:e.prescription.treatmentCycle,"onUpdate:modelValue":t[3]||(t[3]=l=>e.prescription.treatmentCycle=l),required:""},null,8,["modelValue"])]),_:1}),a(r,{label:"要移除的药品"},{default:o(()=>[a(g,{modelValue:e.selectedDrugs,"onUpdate:modelValue":t[4]||(t[4]=l=>e.selectedDrugs=l),multiple:"",filterable:"",placeholder:"请选择要移除的药品",style:{width:"100%"}},{default:o(()=>[(f(!0),N(U,null,k(e.drugs,l=>(f(),x(m,{key:l.id,label:l.drugName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(_,{type:"danger",size:"small",style:{"margin-left":"8px","vertical-align":"middle"},onClick:e.deleteSelectedDrugs,disabled:!e.selectedDrugs.length},{default:o(()=>t[6]||(t[6]=[w("删除")])),_:1,__:[6]},8,["onClick","disabled"])]),_:1}),a(r,{label:"关联药品"},{default:o(()=>[a(g,{modelValue:e.selectedDrugsNew,"onUpdate:modelValue":t[5]||(t[5]=l=>e.selectedDrugsNew=l),multiple:"",filterable:"",placeholder:"请选择关联药品","value-key":"id"},{default:o(()=>[(f(!0),N(U,null,k(e.drugsNew,l=>(f(),x(m,{key:l.id,label:l.drugName,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"药方图片预览"},{default:o(()=>[a(v,{images:e.prescriptionImages},null,8,["images"])]),_:1}),a(r,{label:"药方图片"},{default:o(()=>[a(y,{onUpload:e.handleImageUpload},null,8,["onUpload"])]),_:1}),a(r,null,{default:o(()=>[a(_,{type:"danger","native-type":"submit"},{default:o(()=>t[7]||(t[7]=[w("更新药方")])),_:1,__:[7]}),a(_,{onClick:e.cancel},{default:o(()=>t[8]||(t[8]=[w("取消")])),_:1,__:[8]},8,["onClick"])]),_:1})]),_:1},8,["onSubmit","model"])])}const O=B(j,[["render",T],["__scopeId","data-v-422da2e2"]]);export{O as default};
